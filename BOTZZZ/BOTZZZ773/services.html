<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Our Services - BOTZZZ773 SMM Panel</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="container">
            <div class="nav-wrapper">
                <a href="index.html" class="logo">
                    <span class="logo-text">BOTZZZ<span class="logo-highlight">773</span></span>
                </a>
                <button class="mobile-toggle" id="mobileToggle">
                    <span></span><span></span><span></span>
                </button>
                <ul class="nav-menu" id="navMenu">
                    <li><a href="index.html" class="nav-link">Home</a></li>
                    <li><a href="services.html" class="nav-link active">Services</a></li>
                    <li><a href="order.html" class="nav-link">Order Now</a></li>
                    <li><a href="addfunds.html" class="nav-link">Add Funds</a></li>
                    <li><a href="api.html" class="nav-link">API</a></li>
                    <li><a href="tickets.html" class="nav-link">Tickets</a></li>
                    <li><a href="contact.html" class="nav-link">Contact</a></li>
                    <li id="authNavItem"><a href="signin.html" class="nav-link btn-primary">Sign In</a></li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Page Header -->
    <section class="page-header">
        <div class="container">
            <h1 class="page-title">Our <span class="gradient-text">Services</span></h1>
            <p class="page-subtitle">1000+ premium SMM services at unbeatable prices</p>
        </div>
    </section>

    <!-- Service Filter -->
    <section class="service-filter">
        <div class="container">
            <div class="filter-buttons">
                <button class="filter-btn active" data-filter="all">All Services</button>
                <button class="filter-btn" data-filter="instagram">üì± Instagram</button>
                <button class="filter-btn" data-filter="tiktok">üéµ TikTok</button>
                <button class="filter-btn" data-filter="youtube">‚ñ∂Ô∏è YouTube</button>
                <button class="filter-btn" data-filter="twitter">üê¶ Twitter</button>
                <button class="filter-btn" data-filter="facebook">üë• Facebook</button>
                <button class="filter-btn" data-filter="telegram">üí¨ Telegram</button>
            </div>
            <div class="search-box">
                <input type="text" id="serviceSearch" placeholder="üîç Search services..." class="search-input">
            </div>
        </div>
    </section>

    <!-- Services List -->
    <section class="services-list">
        <div class="container" id="servicesContainer">
            <!-- T√ºm kategoriler burada JS ile y√ºklenecek -->
        </div>
    </section>

    <!-- CTA Section -->
    <section class="cta-section">
        <div class="container">
            <div class="cta-content">
                <h2 class="cta-title">Ready to Order?</h2>
                <p class="cta-subtitle">Get started with the best SMM services now!</p>
                <a href="order.html" class="btn btn-primary btn-large">Order Now</a>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-grid">
                <div class="footer-col">
                    <h4 class="footer-title">BOTZZZ<span class="logo-highlight">773</span></h4>
                    <p class="footer-desc">The world's #1 SMM panel providing premium social media services at unbeatable prices.</p>
                </div>
                <div class="footer-col">
                    <h4 class="footer-heading">Quick Links</h4>
                    <ul class="footer-links">
                        <li><a href="index.html">Home</a></li>
                        <li><a href="services.html">Services</a></li>
                        <li><a href="order.html">Order Now</a></li>
                        <li><a href="contact.html">Contact</a></li>
                    </ul>
                </div>
                <div class="footer-col">
                    <h4 class="footer-heading">Services</h4>
                    <ul class="footer-links">
                        <li><a href="services.html#instagram">Instagram</a></li>
                        <li><a href="services.html#tiktok">TikTok</a></li>
                        <li><a href="services.html#youtube">YouTube</a></li>
                        <li><a href="services.html#twitter">Twitter</a></li>
                    </ul>
                </div>
                <div class="footer-col">
                    <h4 class="footer-heading">Contact</h4>
                    <ul class="footer-links">
                        <li>üìß support@botzzz773.com</li>
                        <li>üí¨ 24/7 Live Chat</li>
                        <li>üåê Worldwide Service</li>
                    </ul>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2025 BOTZZZ773. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <!-- Scripts -->
    <script src="js/main.js"></script>
    <script>
        // Minimal helper to avoid XSS when inserting text nodes
        function escapeHtml(str = '') {
            return String(str)
                .replace(/&/g, '&amp;')
                .replace(/</g, '&lt;')
                .replace(/>/g, '&gt;')
                .replace(/"/g, '&quot;')
                .replace(/'/g, '&#039;');
        }

        function normalizeName(name = '') {
            return String(name || '').trim().toLowerCase().replace(/\s+/g, ' ');
        }
        function slugify(name = '') {
            return String(name || '').toLowerCase().replace(/[^a-z0-9]+/g, '');
        }

        async function loadServices() {
            const container = document.getElementById('servicesContainer');
            if (!container) return;

            try {
                // fetch both endpoints, tolerate admin-services failure
                const [publicResult, adminResult] = await Promise.allSettled([
                    fetch('/.netlify/functions/services'),
                    fetch('/.netlify/functions/admin-services')
                ]);

                if (publicResult.status !== 'fulfilled') {
                    throw new Error('Failed to fetch services: ' + String(publicResult.reason));
                }
                const resPublic = publicResult.value;
                if (!resPublic.ok) {
                    const body = await resPublic.text().catch(() => '<no body>');
                    throw new Error('Services endpoint error ' + resPublic.status + ': ' + body);
                }

                const data = await resPublic.json();

                // parse admin list (optional)
                let adminServices = [];
                if (adminResult && adminResult.status === 'fulfilled') {
                    const resAdmin = adminResult.value;
                    if (resAdmin.ok) {
                        try {
                            const adminData = await resAdmin.json();
                            adminServices = Array.isArray(adminData.services) ? adminData.services : (Array.isArray(adminData) ? adminData : []);
                        } catch (e) {
                            console.warn('admin-services returned invalid JSON, ignoring:', e);
                        }
                    } else {
                        const adminBody = await resAdmin.text().catch(() => '<no body>');
                        console.warn('admin-services endpoint responded', resAdmin.status, adminBody);
                    }
                } else if (adminResult && adminResult.status === 'rejected') {
                    console.warn('admin-services fetch failed:', adminResult.reason);
                }

                // Build multiple lookup maps from admin-services for best matching
                const adminByAnyId = {};      // map any id value -> admin record
                const adminByName = {};       // exact normalized name -> admin record
                const adminBySlug = {};       // slugified name -> admin record
                const adminByExternal = {};   // external/public id -> admin record

                adminServices.forEach(a => {
                    // collect possible id fields on admin record
                    const candidates = [
                        a.service_id, a.id, a.admin_service_id,
                        a.public_id, a.external_id, a.externalId, a.source_id
                    ].filter(Boolean);

                    candidates.forEach(c => {
                        adminByAnyId[String(c)] = a;
                    });

                    if (a.name) {
                        adminByName[normalizeName(a.name)] = a;
                        adminBySlug[slugify(a.name)] = a;
                    }

                    // if admin has a public/external id field, map it
                    if (a.public_id) adminByExternal[String(a.public_id)] = a;
                    if (a.external_id) adminByExternal[String(a.external_id)] = a;
                });

                container.innerHTML = '';

                const services = Array.isArray(data.services) ? data.services : (Array.isArray(data) ? data : []);
                const publicServices = services.filter(s => String(s.status ?? 'active').toLowerCase() === 'active');

                if (publicServices.length === 0) {
                    container.innerHTML = '<div style="padding:2rem; color:#666; text-align:center;">No services available</div>';
                    return;
                }

                // Group by category and render
                const categories = {};
                publicServices.forEach(service => {
                    const cat = service.category || 'Uncategorized';
                    if (!categories[cat]) categories[cat] = [];
                    categories[cat].push(service);
                });

                for (const [category, servicesList] of Object.entries(categories)) {
                    const categoryDiv = document.createElement('div');
                    categoryDiv.classList.add('service-category');
                    categoryDiv.dataset.category = category;

                    categoryDiv.innerHTML = `
                        <h2 class="category-title">${escapeHtml(category.charAt(0).toUpperCase() + category.slice(1))} Services</h2>
                        <div class="service-subcategory">
                            <div class="services-table">
                                <div class="service-row service-row-header">
                                    <div class="service-col">Service ID</div>
                                    <div class="service-col">Service Name</div>
                                    <div class="service-col">Rate (per 1000)</div>
                                    <div class="service-col">Min/Max</div>
                                    <div class="service-col">Action</div>
                                </div>
                            </div>
                        </div>
                    `;
                    container.appendChild(categoryDiv);

                    const table = categoryDiv.querySelector('.services-table');

                    servicesList.forEach(service => {
                        // 1) prefer explicit admin id on public service if provided
                        let resolvedAdminRec = null;
                        const explicitAdminId = service.admin_service_id ?? service.service_id ?? service.adminId ?? service.external_admin_id;
                        if (explicitAdminId && adminByAnyId[String(explicitAdminId)]) {
                            resolvedAdminRec = adminByAnyId[String(explicitAdminId)];
                        }

                        // 2) try exact name match
                        if (!resolvedAdminRec && service.name) {
                            const n = normalizeName(service.name);
                            if (adminByName[n]) resolvedAdminRec = adminByName[n];
                        }

                        // 3) try external/public id fields on public service
                        if (!resolvedAdminRec) {
                            const pubIds = [service.public_id, service.publicId, service.external_id, service.externalId, service.site_id, service.siteId].filter(Boolean);
                            for (const pid of pubIds) {
                                if (adminByExternal[String(pid)]) {
                                    resolvedAdminRec = adminByExternal[String(pid)];
                                    break;
                                }
                                if (adminByAnyId[String(pid)]) {
                                    resolvedAdminRec = adminByAnyId[String(pid)];
                                    break;
                                }
                            }
                        }

                        // 4) try matching by internal id (service.id) to any admin id
                        if (!resolvedAdminRec && service.id) {
                            const a = adminByAnyId[String(service.id)];
                            if (a) resolvedAdminRec = a;
                        }

                        // 5) try slug name match (removes punctuation/space differences)
                        if (!resolvedAdminRec && service.name) {
                            const s = slugify(service.name);
                            if (adminBySlug[s]) resolvedAdminRec = adminBySlug[s];
                        }

                        // Finally pick admin id value from resolved admin record or fallback to explicit fields or internal id
                        let adminIdValue = null;
                        if (resolvedAdminRec) {
                            adminIdValue = resolvedAdminRec.service_id ?? resolvedAdminRec.id ?? resolvedAdminRec.admin_service_id ?? resolvedAdminRec.public_id ?? resolvedAdminRec.external_id;
                        }
                        adminIdValue = adminIdValue ?? explicitAdminId ?? service.public_id ?? service.publicId ?? service.id ?? '(unknown)';

                        // set display label and order link param
                        const displayIdLabel = adminIdValue ? `#${escapeHtml(String(adminIdValue))}` : '‚Äî';
                        const rate = service.rate !== undefined ? escapeHtml(String(service.rate)) : '0';
                        const minQ = service.min_quantity ?? service.min_order ?? 'N/A';
                        const maxQ = service.max_quantity ?? service.max_order ?? 'Unlimited';

                        // Optionally attach resolved admin id back onto service object for downstream pages
                        service.admin_service_id = adminIdValue;

                        const row = document.createElement('div');
                        row.classList.add('service-row');
                        row.innerHTML = `
                            <div class="service-col">${displayIdLabel}</div>
                            <div class="service-col">
                                <strong>${escapeHtml(service.name || 'Unnamed')}</strong>
                                ${service.description ? `<span class="service-details">${escapeHtml(service.description)}</span>` : ''}
                            </div>
                            <div class="service-col price">$${rate}</div>
                            <div class="service-col">${escapeHtml(String(minQ))} / ${escapeHtml(String(maxQ))}</div>
                            <div class="service-col">
                                <a href="order.html?service=${encodeURIComponent(String(service.id))}&admin_service_id=${encodeURIComponent(String(adminIdValue))}" class="btn btn-primary btn-sm">Order</a>
                            </div>
                        `;
                        table.appendChild(row);
                    });
                }
            } catch (err) {
                console.error('Failed to load services', err);
                container.innerHTML = '<div style="padding:2rem; color:#c00; text-align:center;">Failed to load services. ' + escapeHtml(String(err && err.message ? err.message : err)) + '</div>';
            }
        }

        // initialize
        loadServices();
    </script>
</body>
</html>










