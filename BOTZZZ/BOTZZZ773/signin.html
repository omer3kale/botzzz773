<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sign In - BOTZZZ773</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/auth-styles.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <!-- Google Sign-In -->
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <!-- PWA Configuration -->
    <link rel="manifest" href="/manifest.json">
    <meta name="theme-color" content="#ff1494">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="BOTZZZ773 Pro">

    <!-- Icons for iOS -->
    <link rel="apple-touch-icon" sizes="72x72" href="/img/icons/icon-72x72.png">
    <link rel="apple-touch-icon" sizes="96x96" href="/img/icons/icon-96x96.png">
    <link rel="apple-touch-icon" sizes="128x128" href="/img/icons/icon-128x128.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/img/icons/icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/img/icons/icon-152x152.png">
    <link rel="apple-touch-icon" sizes="192x192" href="/img/icons/icon-192x192.png">
    <link rel="apple-touch-icon" sizes="384x384" href="/img/icons/icon-384x384.png">
    <link rel="apple-touch-icon" sizes="512x512" href="/img/icons/icon-512x512.png">

</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="container">
            <div class="nav-wrapper">
                <a href="index.html" class="logo">
                    <span class="logo-text">BOTZZZ<span class="logo-highlight">773</span></span>
                </a>
                <button class="mobile-toggle" id="mobileToggle">
                    <span></span>
                    <span></span>
                    <span></span>
                </button>
                <ul class="nav-menu" id="navMenu">
                    <li><a href="index.html" class="nav-link">Home</a></li>
                    <li><a href="services.html" class="nav-link">Services</a></li>
                    <li><a href="order.html" class="nav-link">Order Now</a></li>
                    <li><a href="addfunds.html" class="nav-link">Add Funds</a></li>
                    <li><a href="api.html" class="nav-link">API</a></li>
                    <li><a href="tickets.html" class="nav-link">Tickets</a></li>
                    <li><a href="contact.html" class="nav-link">Contact</a></li>
                </ul>
                <div class="nav-auth-controls">
                    <div class="auth-buttons">
                        <a href="signin.html" class="btn btn-outline">Sign In</a>
                        <a href="signup.html" class="btn btn-primary">Sign Up</a>
                    </div>
                    <div class="user-menu" style="display: none;">
                        <button class="user-menu-btn" type="button">
                            <span class="username">Account</span>
                            <span class="balance">$0.00</span>
                            <i class="fas fa-chevron-down"></i>
                        </button>
                        <div class="user-dropdown">
                            <a href="dashboard.html"><i class="fas fa-home"></i> Dashboard</a>
                            <a href="addfunds.html"><i class="fas fa-wallet"></i> Add Funds</a>
                            <a href="tickets.html"><i class="fas fa-ticket-alt"></i> Tickets</a>
                            <a href="#" onclick="handleLogout(); return false;"><i class="fas fa-sign-out-alt"></i> Logout</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Auth Section -->
    <section class="auth-section">
        <div class="container">
            <div class="auth-container">
                <div class="auth-card">
                    <div class="auth-header">
                        <h1>Welcome Back</h1>
                        <p>Sign in to your account to continue</p>
                    </div>

                    <form id="signinForm" class="auth-form">
                        <div class="form-group">
                            <label for="email">Email Address</label>
                            <input 
                                type="email" 
                                id="email" 
                                name="email" 
                                placeholder="your@email.com" 
                                required
                                autocomplete="email"
                            >
                        </div>

                        <div class="form-group">
                            <label for="password">Password</label>
                            <div class="password-input">
                                <input 
                                    type="password" 
                                    id="password" 
                                    name="password" 
                                    placeholder="Enter your password" 
                                    required
                                    autocomplete="current-password"
                                >
                                <button type="button" class="toggle-password" onclick="togglePassword()">
                                    <svg class="eye-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                                        <circle cx="12" cy="12" r="3"></circle>
                                    </svg>
                                </button>
                            </div>
                        </div>

                        <div class="form-options">
                            <label class="checkbox-label">
                                <input type="checkbox" id="remember" name="remember">
                                <span>Remember me</span>
                            </label>
                            <div class="auth-links">
                                <a href="#" class="forgot-link">Forgot password?</a>
                            </div>
                        </div>

                        <button type="submit" class="btn-submit">Sign In</button>
                    </form>

                    <div class="auth-divider">
                        <span>or</span>
                    </div>

                    <div class="social-auth">
                        <!-- Google Sign-In Button -->
                        <div id="g_id_onload"
                             data-client_id="330182310617-douv2oleom0f2f9ak27qhh5t6om5tu06.apps.googleusercontent.com"
                             data-context="signin"
                             data-ux_mode="popup"
                             data-callback="handleGoogleSignIn"
                             data-auto_prompt="false">
                        </div>
                        
                        <div class="g_id_signin" 
                             data-type="standard"
                             data-shape="rectangular"
                             data-theme="filled_black"
                             data-text="continue_with"
                             data-size="large"
                             data-logo_alignment="left"
                             data-width="100%">
                        </div>
                    </div>

                    <div class="auth-footer">
                        <p>Don't have an account? <a href="signup.html">Sign Up</a></p>
                    </div>
                </div>

                <!-- Features Side Panel -->
                <div class="auth-features">
                    <h2>Why Choose BOTZZZ773?</h2>
                    <div class="features-list">
                        <div class="feature-item">
                            <div class="feature-icon">
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polyline points="20 6 9 17 4 12"></polyline>
                                </svg>
                            </div>
                            <div class="feature-content">
                                <h3>Instant Delivery</h3>
                                <p>Get your orders started within seconds</p>
                            </div>
                        </div>
                        <div class="feature-item">
                            <div class="feature-icon">
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
                                    <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
                                </svg>
                            </div>
                            <div class="feature-content">
                                <h3>Secure Payments</h3>
                                <p>Your transactions are safe with us</p>
                            </div>
                        </div>
                        <div class="feature-item">
                            <div class="feature-icon">
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                    <polyline points="7 10 12 15 17 10"></polyline>
                                    <line x1="12" y1="15" x2="12" y2="3"></line>
                                </svg>
                            </div>
                            <div class="feature-content">
                                <h3>24/7 Support</h3>
                                <p>We're here to help anytime you need</p>
                            </div>
                        </div>
                        <div class="feature-item">
                            <div class="feature-icon">
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <line x1="12" y1="1" x2="12" y2="23"></line>
                                    <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
                                </svg>
                            </div>
                            <div class="feature-content">
                                <h3>Best Prices</h3>
                                <p>Competitive rates for all services</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Admin OTP Modal -->
    <div class="otp-modal-backdrop" id="adminOtpModal" aria-hidden="true">
        <div class="otp-modal" role="dialog" aria-labelledby="otpModalTitle" aria-modal="true">
            <button type="button" class="otp-modal-close" id="closeAdminOtpModal" aria-label="Close admin verification">
                &times;
            </button>
            <div class="otp-modal-header">
                <h2 id="otpModalTitle">Admin Verification</h2>
                <p>Enter the 6-digit code we sent to your admin email to unlock the panel.</p>
            </div>
            <form id="adminOtpForm" class="otp-form">
                <div class="otp-input-group">
                    <label for="adminOtpInput" class="sr-only">Admin OTP Code</label>
                    <input
                        type="text"
                        id="adminOtpInput"
                        name="adminOtpInput"
                        inputmode="numeric"
                        autocomplete="one-time-code"
                        maxlength="6"
                        pattern="[0-9]*"
                        placeholder="000000"
                        required
                    >
                </div>
                <div class="otp-meta">
                    <span id="otpCountdown">Code expires in 10:00</span>
                    <button type="button" id="resendAdminOtp" class="otp-link" disabled>Resend code</button>
                </div>
                <div class="otp-feedback" id="adminOtpFeedback" role="alert"></div>
                <button type="submit" class="btn-submit otp-submit">Verify &amp; Continue</button>
            </form>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>BOTZZZ<span>773</span></h3>
                    <p>Your trusted SMM panel provider for all social media marketing needs.</p>
                </div>
                <div class="footer-section">
                    <h4>Quick Links</h4>
                    <ul>
                        <li><a href="services.html">Services</a></li>
                        <li><a href="order.html">Order Now</a></li>
                        <li><a href="api.html">API</a></li>
                        <li><a href="tickets.html">Support</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h4>Support</h4>
                    <ul>
                        <li><a href="contact.html">Contact Us</a></li>
                        <li><a href="tickets.html">Tickets</a></li>
                        <li><a href="#">FAQ</a></li>
                        <li><a href="#">Terms of Service</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h4>Connect</h4>
                    <div class="social-links">
                        <a href="#">Instagram</a>
                        <a href="#">Twitter</a>
                        <a href="#">Facebook</a>
                    </div>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2024 BOTZZZ773. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <!-- API Client -->
    <script src="js/api-client.js"></script>
    <script src="js/main.js"></script>
    <script src="js/auth-backend.js"></script>
    <script>
        // Google Sign-In Handler
        function handleGoogleSignIn(response) {
            console.log('Google Sign-In response:', response);
            
            // Decode the JWT token
            const credential = response.credential;
            const payload = JSON.parse(atob(credential.split('.')[1]));
            
            console.log('Google user data:', payload);
            
            // Send to backend to create/login user
            fetch('/.netlify/functions/auth', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    action: 'google-signin',
                    credential: credential,
                    email: payload.email,
                    name: payload.name,
                    picture: payload.picture
                })
            })
            .then(response => response.json())
            .then(data => {
                console.log('Backend response:', data);
                if (data.success) {
                    // Store token (use 'token' not 'authToken' to match auth-backend.js)
                    localStorage.setItem('token', data.token);
                    localStorage.setItem('user', JSON.stringify(data.user));
                    
                    // Show success message
                    console.log('Google Sign-In successful!');
                    
                    // Redirect based on role
                    if (data.user.role === 'admin') {
                        window.location.href = '/admin/index.html';
                    } else {
                        window.location.href = '/dashboard.html';
                    }
                } else {
                    console.error('Sign-in failed:', data.error);
                    alert(data.error || 'Google Sign-In failed. Please try again.');
                }
            })
            .catch(error => {
                console.error('Google Sign-In error:', error);
                alert('An error occurred during Google Sign-In. Please try again.');
            });
        }
        
        // Password toggle function
        function togglePassword() {
            const passwordInput = document.getElementById('password');
            const type = passwordInput.type === 'password' ? 'text' : 'password';
            passwordInput.type = type;
        }
    </script>
    <!-- PWA Registration -->
    <script src="/js/pwa.js"></script>

</body>
</html>
