<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API Tests - BOTZZZ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: #f5f5f5;
            padding: 2rem;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            padding: 2rem;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        h1 {
            color: #1a1a1a;
            margin-bottom: 1rem;
        }

        .test-section {
            margin-bottom: 2rem;
            padding: 1.5rem;
            background: #f9fafb;
            border-radius: 8px;
            border-left: 4px solid #FF1494;
        }

        .test-section h2 {
            color: #1a1a1a;
            margin-bottom: 1rem;
            font-size: 1.25rem;
        }

        .test-controls {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
            flex-wrap: wrap;
        }

        .test-controls input,
        .test-controls select {
            padding: 0.5rem 1rem;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 0.9rem;
        }

        button {
            padding: 0.75rem 1.5rem;
            background: #FF1494;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: background 0.3s;
        }

        button:hover {
            background: #d90f7a;
        }

        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .test-result {
            margin-top: 1rem;
            padding: 1rem;
            background: white;
            border-radius: 6px;
            border: 1px solid #ddd;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            max-height: 300px;
            overflow-y: auto;
        }

        .success {
            background: #ecfdf5;
            border-color: #10b981;
            color: #065f46;
        }

        .error {
            background: #fef2f2;
            border-color: #ef4444;
            color: #991b1b;
        }

        .info {
            background: #eff6ff;
            border-color: #3b82f6;
            color: #1e40af;
        }

        pre {
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        .status-badge {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 12px;
            font-size: 0.85rem;
            font-weight: 600;
            margin-left: 0.5rem;
        }

        .status-pass {
            background: #d1fae5;
            color: #065f46;
        }

        .status-fail {
            background: #fee2e2;
            color: #991b1b;
        }

        .summary {
            margin-top: 2rem;
            padding: 1.5rem;
            background: #1a1a1a;
            color: white;
            border-radius: 8px;
        }

        .summary h3 {
            margin-bottom: 1rem;
        }

        .summary-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
        }

        .stat-card {
            background: rgba(255,255,255,0.1);
            padding: 1rem;
            border-radius: 6px;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
        }

        .stat-label {
            color: #9ca3af;
            font-size: 0.9rem;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ BOTZZZ API Test Suite</h1>
        <p style="color: #666; margin-bottom: 2rem;">Test all backend API endpoints</p>

        <!-- Auth Tests -->
        <div class="test-section">
            <h2>Authentication Tests</h2>
            <div class="test-controls">
                <input type="email" id="testEmail" placeholder="Email" value="admin@botzzz.com">
                <input type="password" id="testPassword" placeholder="Password" value="admin123">
                <button onclick="testLogin()">Test Login</button>
                <button onclick="testSignup()">Test Signup</button>
                <button onclick="testVerifyToken()">Verify Token</button>
            </div>
            <div id="authResult" class="test-result info">Results will appear here...</div>
        </div>

        <!-- User Tests -->
        <div class="test-section">
            <h2>User Management Tests</h2>
            <div class="test-controls">
                <button onclick="testGetUser()">Get Current User</button>
                <button onclick="testUpdateUser()">Update User</button>
            </div>
            <div id="userResult" class="test-result info">Results will appear here...</div>
        </div>

        <!-- Service Tests -->
        <div class="test-section">
            <h2>Service Tests</h2>
            <div class="test-controls">
                <button onclick="testGetServices()">Get Services</button>
                <button onclick="testCreateService()">Create Service (Admin)</button>
            </div>
            <div id="serviceResult" class="test-result info">Results will appear here...</div>
        </div>

        <!-- Order Tests -->
        <div class="test-section">
            <h2>Order Tests</h2>
            <div class="test-controls">
                <button onclick="testGetOrders()">Get Orders</button>
                <button onclick="testCreateOrder()">Create Order</button>
            </div>
            <div id="orderResult" class="test-result info">Results will appear here...</div>
        </div>

        <!-- Payment Tests -->
        <div class="test-section">
            <h2>Payment Tests</h2>
            <div class="test-controls">
                <input type="number" id="testAmount" placeholder="Amount" value="10" min="5">
                <select id="testPaymentMethod">
                    <option value="payeer">Payeer</option>
                    <option value="stripe">Stripe</option>
                </select>
                <button onclick="testCreatePayment()">Create Payment</button>
                <button onclick="testGetPaymentHistory()">Payment History</button>
            </div>
            <div id="paymentResult" class="test-result info">Results will appear here...</div>
        </div>

        <!-- Ticket Tests -->
        <div class="test-section">
            <h2>Ticket Tests</h2>
            <div class="test-controls">
                <button onclick="testGetTickets()">Get Tickets</button>
                <button onclick="testCreateTicket()">Create Ticket</button>
            </div>
            <div id="ticketResult" class="test-result info">Results will appear here...</div>
        </div>

        <!-- Run All Tests -->
        <div style="text-align: center; margin-top: 2rem;">
            <button onclick="runAllTests()" style="padding: 1rem 3rem; font-size: 1.1rem;">
                üöÄ Run All Tests
            </button>
        </div>

        <!-- Summary -->
        <div class="summary" id="testSummary" style="display: none;">
            <h3>Test Summary</h3>
            <div class="summary-stats">
                <div class="stat-card">
                    <div class="stat-value" id="totalTests">0</div>
                    <div class="stat-label">Total Tests</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="passedTests" style="color: #10b981;">0</div>
                    <div class="stat-label">Passed</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="failedTests" style="color: #ef4444;">0</div>
                    <div class="stat-label">Failed</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="successRate">0%</div>
                    <div class="stat-label">Success Rate</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Load API Client -->
    <script src="../js/api-client.js"></script>
    
    <script src="../js/main.js"></script>
    <script>
        let testResults = {
            passed: 0,
            failed: 0,
            total: 0
        };

        // Helper to display results
        function displayResult(elementId, success, message, data = null) {
            const element = document.getElementById(elementId);
            element.className = `test-result ${success ? 'success' : 'error'}`;
            
            let content = `<strong>${success ? '‚úÖ PASS' : '‚ùå FAIL'}: </strong>${message}`;
            if (data) {
                content += `\n\n<strong>Response:</strong>\n<pre>${JSON.stringify(data, null, 2)}</pre>`;
            }
            element.innerHTML = content;

            testResults.total++;
            if (success) {
                testResults.passed++;
            } else {
                testResults.failed++;
            }
            updateSummary();
        }

        // Auth Tests
        async function testLogin() {
            const email = document.getElementById('testEmail').value;
            const password = document.getElementById('testPassword').value;
            
            try {
                const data = await api.login(email, password);
                if (data.success && data.token) {
                    localStorage.setItem('token', data.token);
                    displayResult('authResult', true, 'Login successful', data);
                } else {
                    displayResult('authResult', false, 'Login failed', data);
                }
            } catch (error) {
                displayResult('authResult', false, error.message, { error: error.message });
            }
        }

        async function testSignup() {
            const email = `test${Date.now()}@example.com`;
            const password = 'Test123!@#';
            
            try {
                const data = await api.signup(email, password, `user${Date.now()}`, 'Test', 'User');
                displayResult('authResult', data.success, data.success ? 'Signup successful' : 'Signup failed', data);
            } catch (error) {
                displayResult('authResult', false, error.message, { error: error.message });
            }
        }

        async function testVerifyToken() {
            const token = localStorage.getItem('token');
            if (!token) {
                displayResult('authResult', false, 'No token found. Please login first.');
                return;
            }
            
            try {
                const data = await api.verifyToken(token);
                displayResult('authResult', data.success, data.success ? 'Token valid' : 'Token invalid', data);
            } catch (error) {
                displayResult('authResult', false, error.message, { error: error.message });
            }
        }

        // User Tests
        async function testGetUser() {
            try {
                const data = await api.getUser();
                displayResult('userResult', !!data.user, data.user ? 'User data retrieved' : 'Failed to get user', data);
            } catch (error) {
                displayResult('userResult', false, error.message, { error: error.message });
            }
        }

        async function testUpdateUser() {
            try {
                const data = await api.updateUser(null, { first_name: 'Updated' });
                displayResult('userResult', data.success, data.success ? 'User updated' : 'Update failed', data);
            } catch (error) {
                displayResult('userResult', false, error.message, { error: error.message });
            }
        }

        // Service Tests
        async function testGetServices() {
            try {
                const data = await api.getServices();
                displayResult('serviceResult', !!data.services, `Retrieved ${data.services?.length || 0} services`, data);
            } catch (error) {
                displayResult('serviceResult', false, error.message, { error: error.message });
            }
        }

        async function testCreateService() {
            try {
                const serviceData = {
                    providerId: 1,
                    providerServiceId: '999',
                    name: 'Test Service',
                    category: 'Instagram',
                    price: 1.5,
                    minOrder: 100,
                    maxOrder: 10000
                };
                const data = await api.createService(serviceData);
                displayResult('serviceResult', data.success, data.success ? 'Service created' : 'Create failed', data);
            } catch (error) {
                displayResult('serviceResult', false, error.message, { error: error.message });
            }
        }

        // Order Tests
        async function testGetOrders() {
            try {
                const data = await api.getOrders();
                displayResult('orderResult', !!data.orders, `Retrieved ${data.orders?.length || 0} orders`, data);
            } catch (error) {
                displayResult('orderResult', false, error.message, { error: error.message });
            }
        }

        async function testCreateOrder() {
            displayResult('orderResult', false, 'Manual test: Use the frontend order form to test', null);
        }

        // Payment Tests
        async function testCreatePayment() {
            const amount = parseFloat(document.getElementById('testAmount').value);
            const method = document.getElementById('testPaymentMethod').value;
            
            try {
                const data = await api.createPayment(amount, method);
                displayResult('paymentResult', data.success, data.success ? 'Payment initiated' : 'Payment failed', data);
            } catch (error) {
                displayResult('paymentResult', false, error.message, { error: error.message });
            }
        }

        async function testGetPaymentHistory() {
            try {
                const data = await api.getPaymentHistory();
                displayResult('paymentResult', !!data.payments, `Retrieved ${data.payments?.length || 0} payments`, data);
            } catch (error) {
                displayResult('paymentResult', false, error.message, { error: error.message });
            }
        }

        // Ticket Tests
        async function testGetTickets() {
            try {
                const data = await api.getTickets();
                displayResult('ticketResult', !!data.tickets, `Retrieved ${data.tickets?.length || 0} tickets`, data);
            } catch (error) {
                displayResult('ticketResult', false, error.message, { error: error.message });
            }
        }

        async function testCreateTicket() {
            try {
                const data = await api.createTicket(
                    'Test Ticket',
                    'orders',
                    'medium',
                    'This is a test ticket message'
                );
                displayResult('ticketResult', data.success, data.success ? 'Ticket created' : 'Create failed', data);
            } catch (error) {
                displayResult('ticketResult', false, error.message, { error: error.message });
            }
        }

        // Run all tests
        async function runAllTests() {
            testResults = { passed: 0, failed: 0, total: 0 };
            
            await testLogin();
            await new Promise(resolve => setTimeout(resolve, 500));
            
            await testVerifyToken();
            await new Promise(resolve => setTimeout(resolve, 500));
            
            await testGetUser();
            await new Promise(resolve => setTimeout(resolve, 500));
            
            await testGetServices();
            await new Promise(resolve => setTimeout(resolve, 500));
            
            await testGetOrders();
            await new Promise(resolve => setTimeout(resolve, 500));
            
            await testGetPaymentHistory();
            await new Promise(resolve => setTimeout(resolve, 500));
            
            await testGetTickets();
            
            document.getElementById('testSummary').style.display = 'block';
        }

        function updateSummary() {
            document.getElementById('totalTests').textContent = testResults.total;
            document.getElementById('passedTests').textContent = testResults.passed;
            document.getElementById('failedTests').textContent = testResults.failed;
            
            const rate = testResults.total > 0 ? 
                Math.round((testResults.passed / testResults.total) * 100) : 0;
            document.getElementById('successRate').textContent = rate + '%';
        }
    </script>
</body>
</html>
