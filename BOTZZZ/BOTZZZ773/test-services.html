<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Service Loading Test</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #0f172a;
            color: #e2e8f0;
        }
        h1 { color: #60a5fa; }
        .test-box {
            background: #1e293b;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }
        .success { color: #10b981; }
        .error { color: #ef4444; }
        .info { color: #60a5fa; }
        pre {
            background: #0f172a;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
        }
        button {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background: #2563eb; }
    </style>
    <!-- PWA Configuration -->
    <link rel="manifest" href="/manifest.json">
    <meta name="theme-color" content="#ff1494">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="BOTZZZ773 Pro">

    <!-- Icons for iOS -->
    <link rel="apple-touch-icon" sizes="72x72" href="/img/icons/icon-72x72.png">
    <link rel="apple-touch-icon" sizes="96x96" href="/img/icons/icon-96x96.png">
    <link rel="apple-touch-icon" sizes="128x128" href="/img/icons/icon-128x128.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/img/icons/icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/img/icons/icon-152x152.png">
    <link rel="apple-touch-icon" sizes="192x192" href="/img/icons/icon-192x192.png">
    <link rel="apple-touch-icon" sizes="384x384" href="/img/icons/icon-384x384.png">
    <link rel="apple-touch-icon" sizes="512x512" href="/img/icons/icon-512x512.png">

</head>
<body>
    <h1>üîç Service Loading Diagnostic</h1>
    
    <div class="test-box">
        <h2>Test Controls</h2>
        <button onclick="testFetch()">Test Fetch API</button>
        <button onclick="testXHR()">Test XMLHttpRequest</button>
        <button onclick="clearResults()">Clear Results</button>
    </div>

    <div class="test-box">
        <h2>Results</h2>
        <div id="results"></div>
    </div>

    <script src="js/main.js"></script>
    <script>
        const resultsDiv = document.getElementById('results');

        function log(message, type = 'info') {
            const p = document.createElement('p');
            p.className = type;
            p.textContent = message;
            resultsDiv.appendChild(p);
        }

        function clearResults() {
            resultsDiv.innerHTML = '';
        }

        async function testFetch() {
            clearResults();
            log('üöÄ Testing Fetch API...', 'info');
            
            try {
                const startTime = Date.now();
                const response = await fetch('/.netlify/functions/services', {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                const endTime = Date.now();
                
                log(`‚úÖ Response received in ${endTime - startTime}ms`, 'success');
                log(`Status: ${response.status} ${response.statusText}`, 'info');
                log(`Headers: ${JSON.stringify(Object.fromEntries(response.headers.entries()), null, 2)}`, 'info');
                
                const data = await response.json();
                log(`‚úÖ JSON parsed successfully`, 'success');
                log(`Services count: ${data.services?.length || 0}`, 'info');
                
                if (data.services && data.services.length > 0) {
                    log(`‚úÖ First service: ${data.services[0].name}`, 'success');
                    const pre = document.createElement('pre');
                    pre.textContent = JSON.stringify(data.services[0], null, 2);
                    resultsDiv.appendChild(pre);
                } else {
                    log('‚ùå No services returned!', 'error');
                }
                
            } catch (error) {
                log(`‚ùå ERROR: ${error.message}`, 'error');
                log(`Stack: ${error.stack}`, 'error');
            }
        }

        async function testXHR() {
            clearResults();
            log('üöÄ Testing XMLHttpRequest...', 'info');
            
            return new Promise((resolve, reject) => {
                const xhr = new XMLHttpRequest();
                xhr.open('GET', '/.netlify/functions/services');
                xhr.setRequestHeader('Content-Type', 'application/json');
                
                xhr.onload = function() {
                    log(`‚úÖ Response received`, 'success');
                    log(`Status: ${xhr.status} ${xhr.statusText}`, 'info');
                    log(`Response length: ${xhr.responseText.length} bytes`, 'info');
                    
                    try {
                        const data = JSON.parse(xhr.responseText);
                        log(`‚úÖ JSON parsed successfully`, 'success');
                        log(`Services count: ${data.services?.length || 0}`, 'info');
                        
                        if (data.services && data.services.length > 0) {
                            log(`‚úÖ First service: ${data.services[0].name}`, 'success');
                        }
                    } catch (error) {
                        log(`‚ùå JSON parse error: ${error.message}`, 'error');
                    }
                };
                
                xhr.onerror = function() {
                    log(`‚ùå XHR Error`, 'error');
                };
                
                xhr.ontimeout = function() {
                    log(`‚ùå XHR Timeout`, 'error');
                };
                
                xhr.send();
            });
        }

        // Auto-run test on load
        window.addEventListener('load', () => {
            setTimeout(testFetch, 500);
        });
    </script>
    <!-- PWA Registration -->
    <script src="/js/pwa.js"></script>

</body>
</html>
